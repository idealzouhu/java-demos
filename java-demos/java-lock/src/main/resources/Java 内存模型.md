### 什么是 Java 内存模型

JMM（Java Memory Model，即Java内存模型）由JSR-133（Java Memory Model and Thread Specification）文档描述， 定义了一组**规则**或规范。

该规范定义了一个线程对共享变量的写入时，如何确保对另一个线程是可见的。实际上， JMM提供了合理的禁用缓存以及禁止重排序的方法，所以<font color ="red">**其核心的价值在于解决可见性和有序性**</font>。



### Java 内存模型概念

Java内存模型定义的两个概念：

- <font color="blue">**主存**</font>：主存（Main Memory）是 JVM 的共享内存区域，主要用于存储所有 Java 实例对象（无论该实例对象是成员变量还是方法中的本地变量）和类信息、包含成员变量、静态变量和常量等共享数据。

  - **共享性**：主存中的数据是多个线程共享的，因此对同一变量的并发访问可能导致线程安全问题。
  - **线程安全问题**：由于是共享数据区域，因此多个线程对同一个变量进行访问可能会发现线程安全问题。

- <font color="blue">**工作内存**</font>：工作内存（Working Memory）是每个线程的私有内存区域，主要用于存储线程当前执行方法的所有本地变量信息。**工作内存中存储的是主存中变量的副本**。

  - **私有性**：每个线程都有自己的工作内存，线程之间无法直接访问彼此的工作内存。这意味着线程中的本地变量对其他线程是不可见的，从而避免了线程安全问题。
  - **效率**：由于每个线程可以在自己的工作内存中快速访问和操作本地变量，降低了竞争和冲突的发生，因此提高了程序的执行效率。

  

### Java 内存模型规定

Java内存模型的规定如下： 

- 所有变量存储在主存中。 
- 每个线程都有自己的工作内存，且对变量的操作都是在工作内存中进行的。
- 不同线程之间无法直接访问彼此工作内存中的变量，要想访问只能通过主存来传递。

![image-20240807160015980](images/image-20240807160015980.png)



### 参考资料

[JMM 是如何抽象线程和主内存之间的关系？](https://javaguide.cn/java/concurrent/jmm.html#jmm-是如何抽象线程和主内存之间的关系)

《 极致经典（卷2）：Java高并发核心编程(卷2 加强版) -特供v21-release》